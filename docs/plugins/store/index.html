<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=light data-auto-appearance=true><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="rgb(255,255,255)"><title>Store Plugin &#183; Clace : Web App Deployment Platform</title>
<meta name=title content="Store Plugin &#183; Clace : Web App Deployment Platform"><script type=text/javascript src=/js/appearance.min.022d0ebc3b46a335eb1c7ef79b7f2de143d7cd5156d433638592ef1ce5f8554e.js integrity="sha256-Ai0OvDtGozXrHH73m38t4UPXzVFW1DNjhZLvHOX4VU4="></script><link type=text/css rel=stylesheet href=/css/main.bundle.min.1871b368c6e3ef2e6f9c1c031524c1aac01fe7c4de25bfd195e95684b6c882e9.css integrity="sha256-GHGzaMbj7y5vnBwDFSTBqsAf58TeJb/RlelWhLbIguk="><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.f29ffdffd9ab4cc95250c3c7196b2d5dae8ee6ef0a4139451073f90183ae7e31.js integrity="sha256-8p/9/9mrTMlSUMPHGWstXa6O5u8KQTlFEHP5AYOufjE=" data-copy=Copy data-copied=Copied></script><meta name=description content="
      
        Store plugin provides a document store interface for SQLite and Postgres
      
    "><link rel=canonical href=https://clace.io/docs/plugins/store/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:title" content="Store Plugin"><meta property="og:description" content="Store plugin provides a document store interface for SQLite and Postgres"><meta property="og:type" content="article"><meta property="og:url" content="https://clace.io/docs/plugins/store/"><meta property="article:section" content="docs"><meta property="article:published_time" content="2024-02-18T00:00:00+00:00"><meta property="article:modified_time" content="2024-02-18T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Store Plugin"><meta name=twitter:description content="Store plugin provides a document store interface for SQLite and Postgres"><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","articleSection":"Docs","name":"Store Plugin","headline":"Store Plugin","abstract":"Store plugin provides a document store interface for SQLite and Postgres","inLanguage":"en","url":"https:\/\/clace.io\/docs\/plugins\/store\/","author":{"@type":"Person","name":"Clace"},"copyrightYear":"2024","dateCreated":"2024-02-18T00:00:00\u002b00:00","datePublished":"2024-02-18T00:00:00\u002b00:00","dateModified":"2024-02-18T00:00:00\u002b00:00","mainEntityOfPage":"true","wordCount":"1177"}</script><meta name=author content="Clace"><link href=mailto:contact@clace.io rel=me><link href=https://github.com/claceio rel=me><link href=https://twitter.com/akclace rel=me><link href=https://clace.io/blog/index.xml rel=me><link href=https://discord.gg/t2P8pJFsd7 rel=me><link href='https://fonts.googleapis.com/css?family=Open+Sans:400,600&display=swap' rel=stylesheet></head><body class="m-auto flex h-screen max-w-7xl flex-col bg-neutral px-6 text-lg leading-7 text-neutral-900 sm:px-14 md:px-24 lg:px-32 dark:bg-neutral-800 dark:text-neutral"><div id=the-top class="absolute flex self-center"><a class="-translate-y-8 rounded-b-lg bg-primary-200 px-3 py-1 text-sm focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="pe-2 font-bold text-primary-600 dark:text-primary-400">&darr;</span>Skip to main content</a></div><header class="py-6 font-semibold text-neutral-900 print:hidden sm:py-10 dark:text-neutral"><nav class="flex items-start justify-between sm:items-center"><div class="flex flex-row items-center"><a href=/ class=mr-2><img src=/clace.png width=346 height=89 class="max-h-[10rem] max-w-[10rem] object-scale-down object-left" alt="Clace : Web App Deployment Platform"></a></div><ul class="flex list-none flex-col text-end sm:flex-row"><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><a href=/about/ title="About Clace"><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">About</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><a href=/features/ title=Features><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Features</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><a href=/docs/ title=Docs><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Docs</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><a href=/blog/ title="Clace Blog"><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Blog</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><a href=https://github.com/claceio/clace title target=_blank><span class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><button id=search-button-1 title="Search (/)">
<span class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"><span class="icon relative inline-block px-1 align-text-bottom"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></span><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"></span></button></li></ul></nav></header><div class="relative flex grow flex-col"><main id=main-content class=grow><article><header class=max-w-prose><ol class="text-sm text-neutral-500 print:hidden dark:text-neutral-400"><li class="hidden inline"><a class="dark:underline-neutral-600 decoration-neutral-300 hover:underline" href=/>Clace</a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="dark:underline-neutral-600 decoration-neutral-300 hover:underline" href=/docs/>Docs</a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="dark:underline-neutral-600 decoration-neutral-300 hover:underline" href=/docs/plugins/>Plugins</a><span class="px-1 text-primary-500">/</span></li><li class="hidden inline"><a class="dark:underline-neutral-600 decoration-neutral-300 hover:underline" href=/docs/plugins/store/>Store Plugin</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Store Plugin</h1></header><section class="prose mt-0 flex max-w-full flex-col dark:prose-invert lg:flex-row"><div class="order-first px-0 lg:order-last lg:max-w-xs lg:ps-8"><div class="toc pe-5 print:hidden lg:sticky lg:top-10"><details open class="-ms-5 mt-0 overflow-hidden rounded-lg ps-5"><summary class="-ms-5 block cursor-pointer bg-neutral-100 py-1 ps-5 text-lg font-semibold text-neutral-800 lg:hidden dark:bg-neutral-700 dark:text-neutral-100">Table of Contents</summary><div class="-ms-5 border-s border-dotted border-neutral-300 py-2 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#schema-definition>Schema Definition</a></li><li><a href=#schema-design>Schema Design</a></li><li><a href=#store-types>Store Types</a></li><li><a href=#store-apis>Store APIs</a></li><li><a href=#transactions>Transactions</a></li><li><a href=#automatic-fields>Automatic Fields</a></li><li><a href=#iterators>Iterators</a></li><li><a href=#select-limits-and-sort>Select Limits and Sort</a></li><li><a href=#filter>Filter</a></li></ul></nav></div></details></div></div><div class="min-h-0 min-w-0 max-w-prose grow"><p>The <code>store.in</code> plugin provides a document store interface to work with SQLite tables (PostgreSQL support is coming soon). The goal for the store plugin is to support a full managed interface, creating the app automatically creates the tables required for the app.</p><h2 id=introduction class="relative group">Introduction <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#introduction aria-label=Anchor>#</a></span></h2><p>The <code>store.in</code> plugins automatically creates tables with the specified schema. The tables are created on first load unless they are already present. The tables are linked to the app. The tables use a document store interface. The data is stored as JSON(B) data types. To query the data, a structured interface is used similar to the one provided by MongoDB. The advantage of this approach is that SQL injection is not possible, even if the application code is incorrectly written.</p><h2 id=schema-definition class="relative group">Schema Definition <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#schema-definition aria-label=Anchor>#</a></span></h2><p>The schema for the app is specified in the <code>schema.star</code> file in the root directory of the app code. The format of this file is like:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nb>type</span><span class=p>(</span><span class=s2>&#34;bookmark&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>     <span class=n>fields</span><span class=o>=</span><span class=p>[</span>
</span></span><span class=line><span class=cl>         <span class=n>field</span><span class=p>(</span><span class=s2>&#34;url&#34;</span><span class=p>,</span> <span class=n>STRING</span><span class=p>),</span>
</span></span><span class=line><span class=cl>         <span class=n>field</span><span class=p>(</span><span class=s2>&#34;tags&#34;</span><span class=p>,</span> <span class=n>LIST</span><span class=p>),</span>
</span></span><span class=line><span class=cl>     <span class=p>],</span>
</span></span><span class=line><span class=cl>     <span class=n>indexes</span><span class=o>=</span><span class=p>[</span>
</span></span><span class=line><span class=cl>         <span class=n>index</span><span class=p>([</span><span class=s2>&#34;url&#34;</span><span class=p>],</span> <span class=n>unique</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>     <span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>type</span><span class=p>(</span><span class=s2>&#34;tag&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>     <span class=n>fields</span><span class=o>=</span><span class=p>[</span>
</span></span><span class=line><span class=cl>         <span class=n>field</span><span class=p>(</span><span class=s2>&#34;tag&#34;</span><span class=p>,</span> <span class=n>STRING</span><span class=p>),</span>
</span></span><span class=line><span class=cl>         <span class=n>field</span><span class=p>(</span><span class=s2>&#34;urls&#34;</span><span class=p>,</span> <span class=n>LIST</span><span class=p>),</span>
</span></span><span class=line><span class=cl>     <span class=p>],</span>
</span></span><span class=line><span class=cl>     <span class=n>indexes</span><span class=o>=</span><span class=p>[</span>
</span></span><span class=line><span class=cl>         <span class=n>index</span><span class=p>([</span><span class=s2>&#34;tag&#34;</span><span class=p>],</span> <span class=n>unique</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>     <span class=p>])</span>
</span></span></code></pre></div><p>Multiple types can be specified. Each type has a name, list of fields and list of indexes. Each field has a name and a type, the valid types are <code>INT</code>, <code>STRING</code>, <code>BOOLEAN</code>, <code>LIST</code> and <code>DICT</code>.</p><p>Each type maps to one table in the underlying database. Indexes can be created on the fields. Each index is specified as list of field names. Adding <code>:desc</code> to the field name changes the index to be sorted descending instead of default ascending. Setting <code>unique</code> property to <code>True</code> makes it an unique index.</p><h2 id=schema-design class="relative group">Schema Design <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#schema-design aria-label=Anchor>#</a></span></h2><p>SQL tables are used as underlying storage, but joins are not supported by the <code>store.in</code> interface. The schema design to use would be same as schema used for a
<a href=https://www.mongodb.com/developer/products/mongodb/mongodb-schema-design-best-practices/ target=_blank rel=noreferrer>document database</a>. Since <code>LIST</code> and <code>DICT</code> data types are supported, de-normalized schema is recommended instead of normalized schema.</p><h2 id=store-types class="relative group">Store Types <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#store-types aria-label=Anchor>#</a></span></h2><p>The type information is read from the schema file and schema types are automatically created for the app. The <code>doc</code> namespace has type objects for each type. For the previous example, the two types created are <code>doc.bookmark</code> and <code>doc.tag</code>. The <code>table</code> namespace also has entry populated which reference the table names for the type. For the previous example, the two table names available are <code>table.bookmark</code> and <code>table.tag</code>. This allows creating objects and persisting them using the store API by doing:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>bookmark</span> <span class=o>=</span> <span class=n>doc</span><span class=o>.</span><span class=n>bookmark</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>url</span><span class=o>=</span><span class=s2>&#34;http://clace.io&#34;</span><span class=p>,</span> <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;webapps&#34;</span><span class=p>,</span> <span class=s2>&#34;tools&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>ret</span> <span class=o>=</span> <span class=n>store</span><span class=o>.</span><span class=n>insert</span><span class=p>(</span><span class=n>table</span><span class=o>.</span><span class=n>bookmark</span><span class=p>,</span> <span class=n>bookmark</span><span class=p>)</span>
</span></span></code></pre></div><h2 id=store-apis class="relative group">Store APIs <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#store-apis aria-label=Anchor>#</a></span></h2><p>The API&rsquo;s in the <code>store.in</code> plugin and their arguments and response are:</p><table><thead><tr><th style=text-align:center>API</th><th style=text-align:center>Type</th><th style=text-align:center>Args</th><th style=text-align:center>Response Value</th><th style=text-align:center>Notes</th></tr></thead><tbody><tr><td style=text-align:center><strong>begin</strong></td><td style=text-align:center>Read</td><td style=text-align:center>-</td><td style=text-align:center>-</td><td style=text-align:center>Begin a new transaction</td></tr><tr><td style=text-align:center><strong>commit</strong></td><td style=text-align:center>Write</td><td style=text-align:center>-</td><td style=text-align:center>-</td><td style=text-align:center>Commit active transaction</td></tr><tr><td style=text-align:center><strong>rollback</strong></td><td style=text-align:center>Read</td><td style=text-align:center>-</td><td style=text-align:center>-</td><td style=text-align:center>Rollback active transaction</td></tr><tr><td style=text-align:center><strong>select_by_id</strong></td><td style=text-align:center>Read</td><td style=text-align:center>table: string<br>id : int</td><td style=text-align:center>doc</td><td style=text-align:center>Select one record by id</td></tr><tr><td style=text-align:center><strong>select</strong></td><td style=text-align:center>Read</td><td style=text-align:center>table: string<br>filter : dict<br>sort : list string<br>offset : int<br>limit : int (default 10,000)</td><td style=text-align:center>doc iterator</td><td style=text-align:center>Select by filter</td></tr><tr><td style=text-align:center><strong>select_one</strong></td><td style=text-align:center>Read</td><td style=text-align:center>table: string<br>filter : dict</td><td style=text-align:center>doc</td><td style=text-align:center>Select one by filter</td></tr><tr><td style=text-align:center><strong>count</strong></td><td style=text-align:center>Read</td><td style=text-align:center>table: string<br>filter : dict</td><td style=text-align:center>int</td><td style=text-align:center>Count entries by filter</td></tr><tr><td style=text-align:center><strong>insert</strong></td><td style=text-align:center>Write</td><td style=text-align:center>table: string<br>entry : doc</td><td style=text-align:center>id : int</td><td style=text-align:center>Insert a document</td></tr><tr><td style=text-align:center><strong>update</strong></td><td style=text-align:center>Write</td><td style=text-align:center>table: string<br>entry : doc</td><td style=text-align:center>count : int</td><td style=text-align:center>Update a document</td></tr><tr><td style=text-align:center><strong>delete_by_id</strong></td><td style=text-align:center>Write</td><td style=text-align:center>table: string<br>id : int</td><td style=text-align:center>count : int</td><td style=text-align:center>Delete one document by id</td></tr><tr><td style=text-align:center><strong>delete</strong></td><td style=text-align:center>Write</td><td style=text-align:center>table: string<br>filter : dict</td><td style=text-align:center>count : int</td><td style=text-align:center>Delete multiple docs by filter</td></tr></tbody></table><h2 id=transactions class="relative group">Transactions <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#transactions aria-label=Anchor>#</a></span></h2><p>The transaction handling APIs <code>begin</code>, <code>commit</code> and <code>rollback</code> take no arguments. All the other APIs take the table name as the first argument. The transaction created by the <code>begin</code> is saved in a thread local, there is no need to pass the transaction manually to subsequent API calls. The transaction <code>rollback</code> is automatically done at the end of the API handler if <code>commit</code> is not done explicitly.</p><h2 id=automatic-fields class="relative group">Automatic Fields <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#automatic-fields aria-label=Anchor>#</a></span></h2><p>All tables have some fields added automatically. These are:</p><table><thead><tr><th style=text-align:center>Field</th><th style=text-align:center>Type</th><th style=text-align:center>Notes</th></tr></thead><tbody><tr><td style=text-align:center>_id</td><td style=text-align:center>int</td><td style=text-align:center>Primary key</td></tr><tr><td style=text-align:center>_version</td><td style=text-align:center>int</td><td style=text-align:center>Schema version</td></tr><tr><td style=text-align:center>_created_by</td><td style=text-align:center>string</td><td style=text-align:center>User id</td></tr><tr><td style=text-align:center>_updated_by</td><td style=text-align:center>string</td><td style=text-align:center>User id</td></tr><tr><td style=text-align:center>_created_at</td><td style=text-align:center>timestamp</td><td style=text-align:center></td></tr><tr><td style=text-align:center>_updated_at</td><td style=text-align:center>timestamp</td><td style=text-align:center></td></tr></tbody></table><p>These fields can be accessed like regular user defined field in the store APIs. So <code>bookmark._id</code> can be used the way <code>bookmark.url</code> is used in all the APIs.</p><h2 id=iterators class="relative group">Iterators <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#iterators aria-label=Anchor>#</a></span></h2><p>The <code>select</code> API returns a document iterator. Use a regular python <code>for</code> loop to iterate on the entries. For example,</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>ret</span> <span class=o>=</span> <span class=n>store</span><span class=o>.</span><span class=n>select</span><span class=p>(</span><span class=n>table</span><span class=o>.</span><span class=n>bookmark</span><span class=p>,</span> <span class=p>{},</span> <span class=n>limit</span><span class=o>=</span><span class=mi>100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>sort</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;_created_at:desc&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>ret</span><span class=o>.</span><span class=n>error</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>ace</span><span class=o>.</span><span class=n>response</span><span class=p>({</span><span class=s2>&#34;error&#34;</span><span class=p>:</span> <span class=n>ret</span><span class=o>.</span><span class=n>error</span><span class=p>},</span> <span class=s2>&#34;error&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>bookmarks</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>row</span> <span class=ow>in</span> <span class=n>ret</span><span class=o>.</span><span class=n>value</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>bookmarks</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>row</span><span class=p>)</span>
</span></span></code></pre></div><p>Iterating till the end of the loop automatically closes the iterator. Returning from a handler without closing an iterator will cause the handler to fail. The iterator is automatically closed by the Clace platform to prevent a resource leak. The API failure is used to indicate to the developer that the code needs to be fixed to explicitly close the iterator.</p><div class="flex rounded-md bg-primary-100 px-4 py-3 dark:bg-primary-900"><span class="pe-3 text-primary-400"><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M506.3 417 293 53c-16.33-28-57.54-28-73.98.0l-213.2 364C-10.59 444.9 9.849 480 42.74 480h426.6c32.76.0 53.26-35 36.96-63zM232 168c0-13.25 10.75-24 24-24s24 10.8 24 24v128c0 13.25-10.75 24-23.1 24S232 309.3 232 296V168zm24 248c-17.36.0-31.44-14.08-31.44-31.44s14.07-31.44 31.44-31.44 31.44 14.08 31.44 31.44C287.4 401.9 273.4 416 256 416z"/></svg>
</span></span><span class=dark:text-neutral-300><strong>Note:</strong> The iterator cannot be directly returned from the handler. A list needs to be created and populated if the entries need to be passed to the template.</span></div><h2 id=select-limits-and-sort class="relative group">Select Limits and Sort <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#select-limits-and-sort aria-label=Anchor>#</a></span></h2><p>For the <code>select</code> API, a limit of 10,000 is set as the default limit value. The API can pass a different limit value if required. The maximum value allowed for the limit is 100,000. Passing a limit beyond that will result in an API failure.</p><p>The sort argument can be used to sort the result for the <code>select</code> API. The argument is a list of strings. For example, <code>["age", "city"]</code> is sorted on age and city ascending. <code>["age", "city:desc"]</code> is sorted on age ascending and city descending.</p><h2 id=filter class="relative group">Filter <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#filter aria-label=Anchor>#</a></span></h2><p>The <code>select</code>, <code>select_one</code>, <code>count</code> and <code>delete</code> APIs take a filter parameter. The filter has to be specified as a dict. The format of the filter is similar to the format used by MongoDB. The advantage of this over a SQL expression is that there is no possibility of SQL injection, even with an improperly written application.</p><p>The filter is specified as a list diction, the keys are the names of the field to apply the condition on. The value can be a value, in which case it is treated as a equality match. If the value is an diction, then the it is treated as a expression to apply on the specified field.</p><p>For example, a filter <code>{"age": 30}</code> is equivalent to sql where clause <code>age = ?</code> with the parameter bound to 30. Filter <code>{"age": 30, "city": "New York", "state": "California"}</code> is same as sql <code>age = ? AND city = ? AND state = ?</code>, with the appropriate bindings. To express an or condition, do filter as <code>{"age": 30, "$or": [{"city": "New York"}, {"state": "California"}]}</code>. That translates to <code>age = ? AND ( city = ? OR state = ? )</code></p><p>To express an inequality condition, do <code>{"age": {"$gt": 30}}</code> which becomes <code>age > ?</code>.</p><p>The logical operators supported are <code>$AND</code> and <code>$OR</code>, case insensitive.</p><p>The filter operators supported (case insensitive) are</p><table><thead><tr><th style=text-align:center>Filter</th><th style=text-align:center>SQL</th><th style=text-align:center>Notes</th></tr></thead><tbody><tr><td style=text-align:center>$GT</td><td style=text-align:center>></td><td style=text-align:center></td></tr><tr><td style=text-align:center>$LT</td><td style=text-align:center>&lt;</td><td style=text-align:center></td></tr><tr><td style=text-align:center>$GTE</td><td style=text-align:center>>=</td><td style=text-align:center></td></tr><tr><td style=text-align:center>$LTE</td><td style=text-align:center>&lt;=</td><td style=text-align:center></td></tr><tr><td style=text-align:center>$EQ</td><td style=text-align:center>=</td><td style=text-align:center>Default when value is not a dict</td></tr><tr><td style=text-align:center>$NE</td><td style=text-align:center>!=</td><td style=text-align:center></td></tr><tr><td style=text-align:center>$LIKE</td><td style=text-align:center>like</td><td style=text-align:center>Value has to be passed with % added,<br>it is not added automatically. For example <code>"%test%"</code></td></tr></tbody></table></div></section><footer class="max-w-prose pt-8 print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="group flex" href=/docs/plugins/details/><span class="me-2 text-neutral-700 transition-transform group-hover:-translate-x-[2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"><span class="ltr:inline rtl:hidden">&larr;</span><span class="ltr:hidden rtl:inline">&rarr;</span></span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Plugin Details</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"></span></span></a></span><span></span></div></div></footer></article><div class="pointer-events-none absolute bottom-0 end-0 top-[100vh] w-12"><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 backdrop-blur hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer class="py-10 print:hidden"><div class="flex items-center justify-between"><div><p class="text-sm text-neutral-500 dark:text-neutral-400">Copyright © 2024 ClaceIO, LLC</p></div><div class="flex flex-row items-center"><div class="me-14 cursor-pointer text-sm text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"><button id=appearance-switcher-0 type=button aria-label="appearance switcher"><div class="flex h-12 w-12 items-center justify-center dark:hidden" title="Switch to dark appearance"><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="hidden h-12 w-12 items-center justify-center dark:flex" title="Switch to light appearance"><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div></div></footer><div id=search-wrapper class="invisible fixed inset-0 z-50 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm sm:p-6 md:p-[10vh] lg:p-[12vh] dark:bg-neutral-900/50" data-url=https://clace.io/><div id=search-modal class="top-20 mx-auto flex min-h-0 w-full max-w-3xl flex-col rounded-md border border-neutral-200 bg-neutral shadow-lg dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex flex-none items-center justify-between px-2"><form class="flex min-w-0 flex-auto items-center"><div class="flex h-8 w-8 items-center justify-center text-neutral-400"><span class="icon relative inline-block px-1 align-text-bottom"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="mx-1 flex h-12 flex-auto appearance-none bg-transparent focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex h-8 w-8 items-center justify-center text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto overflow-auto px-2"><ul id=search-results></ul></section></div></div></div></body></html>